<!doctype html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <meta name="robots" content="noindex">
    <title>SHRI - homework #1</title>
    <link rel="stylesheet" href="dist/main.css">
    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
</head>
<body>
    <div class="content">
        <header class="header">
            <div class="header__inner">
                <a href="/" class="logo"></a>
                <div class="container">
                <ul class="list-inline list-unstyled header__menu">
                    <li class="header__menu-item"><a href="#" class="header__menu-link">События</a></li>
                    <li class="header__menu-item"><a href="#" class="header__menu-link">Сводка</a></li>
                    <li class="header__menu-item"><a href="#" class="header__menu-link">Устройства</a></li>
                    <li class="header__menu-item"><a href="#" class="header__menu-link">Сценарии</a></li>
                    <li class="header__menu-item active"><a href="video.html" class="header__menu-link">Видео</a></li>
                </ul>
                <div id="js-side-menu-trigger" class="hamburger">
                    <div class="hamburger__icon"></div>
                </div>
                </div>
            </div>
        </header>
        <main>
            <div class="container">
                <div class="videotiles">
                    <div class="videotile">
                        <div class="card-video">
                            <a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>
                            <label class="card-video__brightness">Яркость, %:
                                <input type="range" class="card-video__input card-video__input-brightness" value="50" min="0" max="50">
                            </label>
                            <label class="card-video__contrast">Контрастность, %:
                                <input type="number" class="card-video__input card-video__input-contrast" value="100">
                            </label>
                            <video id="video-1" class="video" muted autoplay></video>
                        </div>
                    </div>
                    <div class="videotile">
                        <div class="card-video">
                            <a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>
                            <label class="card-video__brightness">Яркость, %:
                                <input type="range" class="card-video__input card-video__input-brightness" value="50" min="0" max="50">
                            </label>
                            <label class="card-video__contrast">Контрастность, %:
                                <input type="number" class="card-video__input card-video__input-contrast" value="100">
                            </label>
                            <video id="video-2" class="video" muted autoplay></video>
                        </div>
                    </div>
                    <div class="videotile">
                        <div class="card-video">
                            <a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>
                            <label class="card-video__brightness">Яркость, %:
                                <input type="range" class="card-video__input card-video__input-brightness" value="50" min="0" max="50">
                            </label>
                            <label class="card-video__contrast">Контрастность, %:
                                <input type="number" class="card-video__input card-video__input-contrast" value="100">
                            </label>
                            <video id="video-3" class="video" muted autoplay></video>
                        </div>
                    </div>
                    <div class="videotile">
                        <div class="card-video">
                            <a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>
                            <label class="card-video__brightness">Яркость, %:
                                <input type="range" class="card-video__input card-video__input-brightness" value="50" min="0" max="50">
                            </label>
                            <label class="card-video__contrast">Контрастность, %:
                                <input type="number" class="card-video__input card-video__input-contrast" value="100">
                            </label>
                            <video id="video-4" class="video" muted autoplay></video>
                        </div>
                    </div>



                    <!--<div class="card-video">-->
                        <!--<a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>-->
                        <!--<label class="card-video__brightness">Яркость, %:-->
                            <!--<input type="range" class="card-video__input card-video__input-brightness" value="50" min="0" max="50">-->
                        <!--</label>-->
                        <!--<label class="card-video__contrast">Контрастность, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-contrast" value="100">-->
                        <!--</label>-->
                        <!--<video id="video-1" class="video" controls muted autoplay></video>-->
                    <!--</div>-->
                    <!--<div class="card-video">-->
                        <!--<a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>-->
                        <!--<label class="card-video__brightness">Яркость, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-brightness" value="100">-->
                        <!--</label>-->
                        <!--<label class="card-video__contrast">Контрастность, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-contrast" value="100">-->
                        <!--</label>-->
                        <!--<div class="volume"></div>-->
                        <!--<video id="video-2" class="video" controls muted autoplay></video>-->
                    <!--</div>-->
                    <!--<div class="card-video">-->
                        <!--<a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>-->
                        <!--<label class="card-video__brightness">Яркость, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-brightness" value="100">-->
                        <!--</label>-->
                        <!--<label class="card-video__contrast">Контрастность, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-contrast" value="100">-->
                        <!--</label>-->
                        <!--<video id="video-3" class="video" controls muted autoplay></video>-->
                    <!--</div>-->
                    <!--<div class="card-video">-->
                        <!--<a href="#" class="btn btn_size_xs card-video__btn-cameras">Все камеры</a>-->
                        <!--<label class="card-video__brightness">Яркость, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-brightness" value="100">-->
                        <!--</label>-->
                        <!--<label class="card-video__contrast">Контрастность, %:-->
                            <!--<input type="number" class="card-video__input card-video__input-contrast" value="100">-->
                        <!--</label>-->
                        <!--<video id="video-4" class="video" controls muted autoplay></video>-->
                    <!--</div>-->
                </div>

            </div>
        </main>
        <footer class="footer">
            <div class="footer__inner">
                <ul class="list-inline list-unstyled footer__links">
                    <li class="footer__links-item"><a href="#" class="footer__link">Помощь</a></li>
                    <li class="footer__links-item"><a href="#" class="footer__link">Обратная связь</a></li>
                    <li class="footer__links-item"><a href="#" class="footer__link">Разработчикам</a></li>
                    <li class="footer__links-item"><a href="#" class="footer__link">Условия использования</a></li>
                    <li class="footer__links-item"><a href="https://docviewer.yandex.ru/view/1130000031416129/?*=NDquAwEqAaHVit0R666Z9nfyxRB7InVybCI6InlhLXdpa2k6Ly93aWtpLWFwaS55YW5kZXgucnUvc2hyaS0yMDE4LWlpL2hvbWV3b3JrL2FkYXB0aXZuYWphLXZqb3JzdGthL2xpY2Vuc2UucGRmIiwidGl0bGUiOiJsaWNlbnNlLnBkZiIsInVpZCI6IjExMzAwMDAwMzE0MTYxMjkiLCJ5dSI6IjYzNTM1OTM5NDE0OTU4MzYxMTciLCJub2lmcmFtZSI6ZmFsc2UsInRzIjoxNTM4ODkzMjg3MTY0fQ%3D%3D" class="footer__link">Авторские права</a></li>
                </ul>
                <div class="footer__copyright">© 2001–2017 &nbsp;ООО «Яндекс»</div>
            </div>
        </footer>
    </div>
    <div class="side-menu">
        <div class="side-menu__content">
            <div class="side-menu__header">
                <div class="logo"></div>
                <div class="cross side-menu__cross">×</div>
            </div>
            <ul class="list-unstyled side-menu__list">
                <li class="side-menu__item"><a href="#" class="menu__link">События</a></li>
                <li class="side-menu__item"><a href="#" class="menu__link">Сводка</a></li>
                <li class="side-menu__item"><a href="#" class="menu__link">Устройства</a></li>
                <li class="side-menu__item"><a href="#" class="menu__link">Сценарии</a></li>
                <li class="side-menu__item active"><a href="video.html" class="menu__link">Видео</a></li>
            </ul>
        </div>
    </div>
    <!--<script src="dist/main.js"></script>-->
    <script>

//        class Stream {
//            constructor(video, url) {
//                if (Hls.isSupported()) {
//                    const hls = new Hls();
//                    hls.loadSource(url);
//                    hls.attachMedia(video);
//
//                    hls.on(Hls.Events.MANIFEST_PARSED, function (e, data) {
//                        // Ставим начальное качество минимальным
//                        console.log(hls);
//                        hls.autoLevelEnabled = false;
//                        hls.loadLevel = 0;
//                        video.play();
//                    });
//
////                    return hls;
//                }
//                else if (video.canPlayType('application/vnd.apple.mpegurl')) {
//                    video.src = url;
//                    video.addEventListener('loadedmetadata', function () {
//                        video.play();
//                    });
//                }
//            }
//        }

function initVideo(video, url) {
    if (Hls.isSupported()) {
        const hls = new Hls();
        hls.loadSource(url);
        hls.attachMedia(video);

        hls.on(Hls.Events.MANIFEST_PARSED, function (e, data) {
            // Ставим начальное качество минимальным
            hls.autoLevelEnabled = false;
            hls.loadLevel = 0;
            video.play();
            console.log(hls);
        });

        return hls;
    }
    else if (video.canPlayType('application/vnd.apple.mpegurl')) {
        video.src = url;
        video.addEventListener('loadedmetadata', function () {
            video.play();
        });
    }
}

//        let video1 = new Stream(
//            document.getElementById('video-1'),
//            'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fsosed%2Fmaster.m3u8'
//        );
//
//        let video2 = new Stream(
//                document.getElementById('video-2'),
//                'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fcat%2Fmaster.m3u8'
//        );
//
//        let video3 = new Stream(
//                document.getElementById('video-3'),
//                'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fdog%2Fmaster.m3u8'
//        );
//
//        let video4 = new Stream(
//                document.getElementById('video-4'),
//                'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fhall%2Fmaster.m3u8'
//        );

let hlsVideo1 = initVideo(
    document.getElementById('video-1'),
    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fsosed%2Fmaster.m3u8'
);


let hlsVideo2 = initVideo(
    document.getElementById('video-2'),
    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fcat%2Fmaster.m3u8'
);

let hlsVideo3 = initVideo(
    document.getElementById('video-3'),
    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fdog%2Fmaster.m3u8'
);

let hlsVideo4 = initVideo(
    document.getElementById('video-4'),
    'http://localhost:9191/master?url=http%3A%2F%2Flocalhost%3A3102%2Fstreams%2Fhall%2Fmaster.m3u8'
);



let container = document.querySelector('.videos');

///**
// * Открытие видео в full режим
// */
//let cards = document.querySelectorAll('.card-video');
//
//let video1 = document.getElementById('video-1');
//
//function initVideotiles() {
//    let tiles = document.querySelectorAll('.videotile');
//
//    for(let i = 0; i < tiles.length; i++) {
//        let context = tiles[i].querySelector('.video-canvas').getContext("2d");
//        let video = tiles[i].querySelector('.video');
//        context.drawImage(video, 0, 0);
//    }
//
//    requestAnimationFrame(initVideotiles);
//}
//initVideotiles();


let videos = document.querySelectorAll('.video');
let videosContainer = document.querySelector('.videotiles');

Video();

function Video() {
    for (let i = 0; i < videos.length; i++) {
        videos[i].addEventListener('click', function() {
            let container = this.parentNode;

            if (container.classList.contains('active'))
                return;

            this.muted = false;



            let videoData = this.getBoundingClientRect();
            let videoWrap = this.parentNode;
            videoWrap.style.width = videoData.width + 'px';
            videoWrap.style.height = videoData.height + 'px';

            console.log(videosContainer.offsetHeight / videoData.height);

            // Задаем absolute обертке видео
//            videoWrap.style.position = 'absolute';
            this.parentNode.classList.add('active');



            let positionCenterX = (document.body.clientWidth / 2) - videoData.x - (videoData.width / 2);
            let positionCenterY = (document.body.clientHeight / 2) - videoData.y - (videoData.height / 2);
            videoWrap.style.transform = `translate3d(${positionCenterX}px, ${positionCenterY}px, 0) scale(2)`;

        })
    }
}

















//for (let i = 0; i < cards.length; i++) {
//    cards[i].addEventListener('click', function (e) {
//        activeCard(this);
//    });
//}

function activeCard(card) {
//    e.preventDefault();

//    this = _this;

    let cardCoords = card.getBoundingClientRect();
    console.log(cardCoords)

    let video = card.querySelector('.video');

//        console.log(this.getBoundingClientRect());

//        let cardStartPosX = this.offsetLeft;
//        let cardStartPosY = this.offsetTop;


//        this.classList.add('card-video_size_full');

//        console.log(container.offsetWidth)
//        console.log(container.offsetHeight)


//        cards[i].style.transform = `translate3d(200px, 0px, 0px)`;
    let positionCenterX = (container.offsetWidth / 2) - (card.offsetWidth / 2);
    let positionCenterY = (container.offsetHeight / 2) - (card.offsetHeight / 2);


//        this.style.transform = `translate3d(${positionCenterX}px, ${positionCenterY}px, 0)`;
//        this.classList.add('card-video_size_full');

    setTimeout(() => {
//            video.style.width = '100%';
//            video.style.height = '100%';
//            this.classList.add('card-video_size_full');
//            this.style.transform = `translate3d(0px, 0px, 0)`;
    }, 100);


//            video.parentNode.querySelector('video')
    // Улучшаем качество в full размере
    hlsVideo1.loadLevel = 2;
//        console.log(hlsVideo1.audioTracks());
}

/**
 * Закрытие full режима
 * @type {NodeList}
 */
let cardsBtn = document.querySelectorAll('.card-video__btn-cameras');

for (let i = 0; i < cardsBtn.length; i++) {
    cardsBtn[i].addEventListener('click', function (e) {
        console.log(`zzzzz`)
        e.preventDefault();
        this.parentElement.classList.remove('card-video_size_full');
        e.stopPropagation();
    });
}

/**
 * Изменение яркости
 * @type {NodeList}
 */
let cardsInputBrightness = document.querySelectorAll('.card-video__input-brightness');

for (let i = 0; i < cardsInputBrightness.length; i++) {
    cardsInputBrightness[i].addEventListener('input', function (e) {
        this.closest('.card-video').querySelector('.video').style.filter = `brightness(${this.value}%)`;
    });
}

/**
 * Изменение Контрастности
 * @type {NodeList}
 */
let cardsInputContrast = document.querySelectorAll('.card-video__input-contrast');

for (let i = 0; i < cardsInputContrast.length; i++) {
    cardsInputContrast[i].addEventListener('input', function (e) {
        this.closest('.card-video').querySelector('.video').style.filter = `contrast(${this.value}%)`;
    });
}

/**
 * Анализатор звука
 */
//let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
//var convolver = audioCtx.createConvolver();
//
//var soundSource, concertHallBuffer;
//
//ajaxRequest = new XMLHttpRequest();
//ajaxRequest.open('GET', document.getElementById('video-2'), true);
//ajaxRequest.responseType = 'arraybuffer';
//
//
//ajaxRequest.onload = function() {
//    var audioData = ajaxRequest.response;
//    audioCtx.decodeAudioData(audioData, function(buffer) {
//        concertHallBuffer = buffer;
//        soundSource = audioCtx.createBufferSource();
//        soundSource.buffer = concertHallBuffer;
//    }, function(e){"Error with decoding audio data" + e.err});
//}
//
//ajaxRequest.send();
//
//convolver.buffer = concertHallBuffer;


//let source = context.createMediaElementSource(document.querySelector('#video-2'));
//let gainNode = context.createGain();
//source.connect(gainNode);
// Create a gain node.
// Connect the source to the gain node.
//console.log(source )
// Connect the gain node to the destination.
//gainNode.connect(context.destination);


    </script>
</body>
</html>





